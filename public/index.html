<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="streamdy.PNG">
    <title>L·ªÖ T·ªët nghi·ªáp - Terminal Style</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
            padding: 20px;
            overflow-x: auto;
        }

        .terminal {
            max-width: 800px;
            margin: 0 auto;
        }

        .ascii-art {
            font-size: 8px;
            line-height: 1;
            white-space: pre;
            margin-bottom: 20px;
            color: #00ff00;
        }

        .command-line {
            margin: 10px 0;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }

        .prompt {
            color: #ffff00;
            display: inline;
        }

        .command {
            color: #00ffff;
        }

        .output {
            margin: 10px 0 20px 0;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }

        .success {
            color: #00ff00;
        }

        .info {
            color: #00aaff;
        }

        .warning {
            color: #ff9900;
        }

        .event-details {
            background: #111;
            border: 1px solid #00ff00;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .detail-row {
            display: flex;
            align-items: center;
            margin: 10px 0;
            gap: 10px;
        }

        .icon {
            font-size: 20px;
            width: 30px;
        }

        .label {
            font-weight: bold;
            min-width: 80px;
        }

        .value {
            color: #ffffff;
        }

        .map-link {
            color: #00ffff;
            text-decoration: underline;
            cursor: pointer;
        }

        .map-link:hover {
            color: #ffff00;
        }

        .button {
            background: #001100;
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 10px 20px;
            font-family: inherit;
            font-size: 14px;
            cursor: pointer;
            margin: 10px 5px;
            border-radius: 3px;
            transition: all 0.3s;
        }

        .decline-btn {
            background: #110000 !important;
            border-color: #ff0000 !important;
            color: #ff0000 !important;
        }

        .decline-btn:hover {
            background: #ff0000 !important;
            color: #000 !important;
            animation: shake 0.5s;
        }

        .stolen-btn {
            position: absolute !important;
            pointer-events: none !important;
            opacity: 0.5 !important;
            transform: translateX(200px) !important;
            transition: all 0.3s ease !important;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .terminal-warning {
            background: #220000;
            border-left: 4px solid #ff0000;
            padding: 10px;
            margin: 10px 0;
            animation: blink-red 1s infinite;
        }

        @keyframes blink-red {
            0%, 50% { background: #220000; }
            51%, 100% { background: #330000; }
        }

        .guestbook {
            margin-top: 30px;
            border-top: 1px solid #333;
            padding-top: 20px;
        }

        .guestbook input {
            background: #000;
            border: 1px solid #00ff00;
            color: #00ff00;
            font-family: inherit;
            border-radius: 3px;
        }

        .guestbook input:focus,
        .guestbook textarea:focus {
            outline: none;
            border-color: #ffff00;
            box-shadow: 0 0 5px #00ff00;
        }

        .typing {
            display: inline-block;
            animation: typing 3s steps(30) 1s forwards, blink 1s infinite;
            white-space: nowrap;
            overflow: hidden;
            border-right: 2px solid #00ff00;
            width: 0;
        }

        @keyframes typing {
            to { width: 100%; }
        }

        @keyframes blink {
            0%, 50% { border-color: #00ff00; }
            51%, 100% { border-color: transparent; }
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .command-line:nth-child(1) { animation-delay: 0s; }
        .command-line:nth-child(2) { animation-delay: 1s; }
        .command-line:nth-child(3) { animation-delay: 2s; }
        .command-line:nth-child(4) { animation-delay: 3s; }
        .command-line:nth-child(5) { animation-delay: 4s; }
        .output:nth-child(6) { animation-delay: 5s; }

        @media (max-width: 600px) {
            .ascii-art {
                font-size: 6px;
            }
            
            body {
                padding: 10px;
                font-size: 12px;
            }
            
            .event-details {
                padding: 15px;
            }
            
            .detail-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="terminal">
        <div class="ascii-art">
 ____  ___  __      __  ___   ____  __  ____ _________  ____   ____  
/  _ \|   ||  |__  |  ||   \ |    \|  ||  __|_   _|_  \|    \ /    | 
|  | ||   ||  ___| |  ||    \|  D  )  ||  _|  | |   | ||  D  )   __| 
|  |_||___||  |    |  ||  D  |    /|  ||  |   | |   | ||    /|  |_  
|     |    |__|    |__||_____|___|_|__||__|   |_|   |_||___|_\|_____|
        </div>

        <div class="command-line">
            <span class="prompt">$ </span>
            <span class="command typing">./graduation.sh --ceremony="Class of 2025"</span>
        </div>

        <div class="command-line">
            <span class="prompt">[] </span>
            <span class="info">INFO</span>
        </div>

        <div class="command-line">
            <span class="success">ƒêƒÉng nh·∫≠p th√†nh c√¥ng!</span>
        </div>

        <div class="command-line">
            <span class="prompt">[] </span>
            <span class="success">SUCCESS</span>
        </div>

        <div class="output">
            <div class="output">
            <!-- Stats Section -->
            <div id="statsDisplay" style="margin-bottom: 30px;">
                <div style="text-align: center; padding: 15px; border: 1px solid #333; background: #111; border-radius: 5px;">
                    <h3 style="color: #00ffff; margin-bottom: 15px;">üìä Th·ªëng k√™ tham d·ª±:</h3>
                    <div id="statsContent">
                        <div class="info" style="color: #666;">ƒêang t·∫£i th·ªëng k√™... ‚è≥</div>
                    </div>
                </div>
            </div>

            <h2 style="color: #ffff00; margin-bottom: 20px;">Th√¢n m·ªùi b·∫°n ƒë·∫øn tham d·ª±:</h2>
            <h1 style="color: #00ffff; margin-bottom: 30px; font-size: 24px;">L·ªÖ T·ªët nghi·ªáp c·ªßa Gi·ªõi</h1>
            
            <div class="event-details">
                <div class="detail-row">
                    <span class="icon">üìÖ</span>
                    <span class="label">Th·ªùi gian:</span>
                    <div class="value">
                        <div>09:30 - 11:00</div>
                        <div>27/09/2025</div>
                    </div>
                </div>
                
                <div class="detail-row">
                    <span class="icon">üìç</span>
                    <span class="label">ƒê·ªãa ƒëi·ªÉm:</span>
                    <div class="value">
                        <div>H·ªôi tr∆∞·ªùng C2</div>
                        <div>ƒê·∫°i h·ªçc B√°ch khoa H√† N·ªôi</div>
                        <div><a href="https://maps.google.com" class="map-link">Click ƒë·ªÉ m·ªü Google Maps</a></div>
                    </div>
                </div>
            </div>

            <div style="margin: 20px 0;">
                <p style="color: #ffff00;">Nh·∫•n "ƒê·ªìng √Ω" v√† vi·∫øt l∆∞u b√∫t cho m√¨nh b√™n d∆∞·ªõi nh√©!</p>
            </div>

            <div class="buttons">
                <button class="button" onclick="confirmAttendance()">ƒê·ªìng √Ω tham d·ª±</button>
                <button class="button decline-btn" id="declineBtn" onclick="declineAttendance()">T·ª´ ch·ªëi</button>
            </div>

            <div class="warning" style="margin-top: 20px;">
                <h3>L∆∞u √Ω:</h3>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>H√£y ƒë·ª©ng ch·ªù m√¨nh quanh qu·∫£ng tr∆∞·ªùng C1 v√† g·ªçi ƒëi·ªán tho·∫°i ƒë·ªÉ bi·∫øt m√¨nh ·ªü ƒë√¢u nh√©.</li>
                    <li>M√¨nh s·∫Ω share link v·ªã tr√≠ tr·ª±c ti·∫øp c·ªßa m√¨nh ·ªü ƒë√¢y v√†o bu·ªïi l·ªÖ t·ªët nghi·ªáp nha.</li>
                </ul>
                
                <!-- Live Location Section -->
                <div id="liveLocation" style="display: none; margin-top: 20px; padding: 15px; border: 2px solid #ffff00; border-radius: 5px; background: #222;">
                    <h3 style="color: #ffff00; margin-bottom: 10px;">üìç V·ªä TR√ç LIVE - Gi·ªõi ƒëang ·ªü ƒë√¢y:</h3>
                    <div id="locationContent"></div>
                </div>
            </div>

            <div class="guestbook" id="guestbook" style="display: none;">
                <h3 style="color: #00ffff; margin-bottom: 15px;">üìù L∆∞u b√∫t cho Gi·ªõi</h3>
                
                <div style="margin-bottom: 15px;">
                    <label style="color: #ffff00; display: block; margin-bottom: 5px;">T√äN C·ª¶A BAN:</label>
                    <input type="text" id="guestName" placeholder="Nh·∫≠p t√™n c·ªßa ban" style="width: 100%; padding: 8px; background: #000; border: 1px solid #00ff00; color: #00ff00; font-family: inherit;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="color: #ffff00; display: block; margin-bottom: 5px;">NH·∫¨P L·ªúI NH·∫ÆN:</label>
                    <textarea id="guestMessage" placeholder="Nh·∫≠p l·ªùi nh·∫Øn cho Gi·ªõi..." style="width: 100%; height: 100px; background: #000; border: 1px solid #00ff00; color: #00ff00; font-family: inherit; padding: 10px; resize: vertical;"></textarea>
                </div>
                
                <div style="text-align: center;">
                    <button class="button" onclick="submitGuestbook()">G·ª¨I</button>
                    <button class="button" style="background: #331100; border-color: #ff6600; color: #ff6600;" onclick="cancelGuestbook()">H·ª¶Y</button>
                </div>
            </div>

            <div class="command-line" style="margin-top: 30px;">
                <span class="prompt">$ </span>
                <span class="command">rsvp --confirm --guests=1</span>
                <span style="animation: blink 1s infinite;">_</span>
            </div>
        </div>
    </div>

    <script>
        // Mobile location sharing functions
        let watchId = null;
        let isSharing = false;

        // Get current location from phone
        function getCurrentLocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Geolocation kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£'));
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    position => {
                        resolve({
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            accuracy: position.coords.accuracy
                        });
                    },
                    error => {
                        reject(new Error('Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠: ' + error.message));
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            });
        }

        // Generate Google Maps link
        function generateMapsLink(lat, lng) {
            return `https://maps.google.com/maps?q=${lat},${lng}&z=17&hl=vi`;
        }

        // Auto-share location every 2 minutes when active
        function startLocationSharing() {
            if (isSharing) return;
            
            isSharing = true;
            addTerminalMessage('INFO', 'üìç B·∫Øt ƒë·∫ßu chia s·∫ª v·ªã tr√≠ live...');

            const shareCurrentLocation = async () => {
                try {
                    const location = await getCurrentLocation();
                    const mapsUrl = generateMapsLink(location.lat, location.lng);
                    
                    // Share location with auto-generated description
                    await shareLocation({
                        isActive: true,
                        description: `üìç V·ªã tr√≠ hi·ªán t·∫°i (${location.accuracy}m ƒë·ªô ch√≠nh x√°c)`,
                        mapUrl: mapsUrl,
                        phone: '0365211103', // Your phone number
                        note: `C·∫≠p nh·∫≠t t·ª± ƒë·ªông l√∫c ${new Date().toLocaleTimeString('vi-VN')}. Click link Maps ƒë·ªÉ t√¨m m√¨nh!`
                    });

                    addTerminalMessage('SUCCESS', `‚úÖ ƒê√£ c·∫≠p nh·∫≠t v·ªã tr√≠: ${location.lat.toFixed(6)}, ${location.lng.toFixed(6)}`);
                } catch (error) {
                    addTerminalMessage('ERROR', `‚ùå L·ªói share location: ${error.message}`, 'terminal-warning');
                }
            };

            // Share immediately
            shareCurrentLocation();

            // Then share every 2 minutes
            watchId = setInterval(shareCurrentLocation, 2 * 60 * 1000);
        }

        // Stop location sharing
        function stopLocationSharing() {
            if (!isSharing) return;
            
            isSharing = false;
            if (watchId) {
                clearInterval(watchId);
                watchId = null;
            }

            // Deactivate location sharing
            shareLocation({ isActive: false });
            addTerminalMessage('INFO', 'üõë ƒê√£ d·ª´ng chia s·∫ª v·ªã tr√≠');
        }

        // Live Location Functions
        async function checkLiveLocation() {
            try {
                const response = await fetch('/api/live-location');
                if (response.ok) {
                    const locationData = await response.json();
                    if (locationData.isActive) {
                        showLiveLocation(locationData);
                    } else {
                        hideLiveLocation();
                    }
                }
            } catch (error) {
                console.error('Error checking location:', error);
            }
        }

        function showLiveLocation(data) {
            const locationDiv = document.getElementById('liveLocation');
            const contentDiv = document.getElementById('locationContent');
            
            locationDiv.style.display = 'block';
            contentDiv.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <strong style="color: #00ff00;">üìç V·ªã tr√≠ hi·ªán t·∫°i:</strong> ${data.description || 'ƒêang c·∫≠p nh·∫≠t...'}
                </div>
                <div style="margin-bottom: 10px;">
                    <strong style="color: #00ff00;">‚è∞ C·∫≠p nh·∫≠t l√∫c:</strong> ${new Date(data.timestamp).toLocaleTimeString('vi-VN')}
                </div>
                ${data.mapUrl ? `
                    <div style="margin-bottom: 10px;">
                        <a href="${data.mapUrl}" target="_blank" class="map-link" style="color: #00ffff;">
                            üó∫Ô∏è M·ªü Google Maps ƒë·ªÉ t√¨m Gi·ªõi
                        </a>
                    </div>
                ` : ''}
                ${data.phone ? `
                    <div style="margin-bottom: 10px;">
                        <strong style="color: #00ff00;">üìû G·ªçi Gi·ªõi:</strong> 
                        <a href="tel:${data.phone}" style="color: #00ffff;">${data.phone}</a>
                    </div>
                ` : ''}
                <div style="font-style: italic; color: #ffff00; font-size: 14px;">
                    ${data.note || 'Gi·ªõi ƒëang ·ªü ƒë√¢y! T√¨m m√¨nh nh√©! üòä'}
                </div>
            `;

            // Add terminal notification
            addTerminalMessage('INFO', `üìç Gi·ªõi ƒë√£ share v·ªã tr√≠ live! Ki·ªÉm tra ph√≠a tr√™n! üéØ`);
        }

        function hideLiveLocation() {
            document.getElementById('liveLocation').style.display = 'none';
        }

        // Start polling for live location (every 30 seconds)
        function startLocationPolling() {
            // Check immediately
            checkLiveLocation();
            
            // Then check every 30 seconds
            locationInterval = setInterval(checkLiveLocation, 30000);
        }

        // Admin functions for location sharing (Gi·ªõi s·ª≠ d·ª•ng)
        async function shareLocation(locationData) {
            try {
                const response = await fetch('/api/share-location', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        ...locationData,
                        timestamp: new Date().toISOString(),
                        adminKey: 'graduation_admin_2025' // Simple auth
                    })
                });
                
                if (response.ok) {
                    console.log('Location shared successfully');
                } else {
                    console.error('Failed to share location');
                }
            } catch (error) {
                console.error('Error sharing location:', error);
            }
        }
            try {
                const response = await fetch('/api/guests');
                if (response.ok) {
                    const guests = await response.json();
                    displayGuestMessages(guests);
                }
            } catch (error) {
                console.error('Error loading guestbook:', error);
            }
        }

        // Display guest messages at the top
        function displayGuestMessages(guests) {
            const container = document.getElementById('guestMessages');
            
            if (guests.length === 0) {
                container.innerHTML = '<div class="info" style="text-align: center; color: #666;">Ch∆∞a c√≥ l·ªùi ch√∫c n√†o... H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n! ‚ú®</div>';
                return;
            }

            // Sort by newest first
            const sortedGuests = guests.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            container.innerHTML = sortedGuests.map(guest => `
                <div style="margin-bottom: 15px; padding: 10px; border-left: 3px solid #00ff00; background: #001100;">
                    <div style="color: #ffff00; font-weight: bold; margin-bottom: 5px;">
                        üíö ${guest.name}
                        <span style="color: #666; font-size: 12px; font-weight: normal;">
                            - ${new Date(guest.timestamp).toLocaleDateString('vi-VN')} 
                            ${new Date(guest.timestamp).toLocaleTimeString('vi-VN', {hour: '2-digit', minute: '2-digit'})}
                        </span>
                    </div>
                    <div style="color: #ffffff; font-style: italic;">
                        "${guest.message}"
                    </div>
                </div>
            `).join('');

            // Auto-scroll to show latest message
            container.scrollTop = 0;
        }

        // Add new message to display immediately
        function addMessageToDisplay(guest) {
            const container = document.getElementById('guestMessages');
            
            const newMessage = document.createElement('div');
            newMessage.style.cssText = 'margin-bottom: 15px; padding: 10px; border-left: 3px solid #00ff00; background: #001100; animation: fadeIn 0.5s;';
            newMessage.innerHTML = `
                <div style="color: #ffff00; font-weight: bold; margin-bottom: 5px;">
                    üíö ${guest.name}
                    <span style="color: #666; font-size: 12px; font-weight: normal;">
                        - ${new Date(guest.timestamp).toLocaleDateString('vi-VN')} 
                        ${new Date(guest.timestamp).toLocaleTimeString('vi-VN', {hour: '2-digit', minute: '2-digit'})}
                    </span>
                </div>
                <div style="color: #ffffff; font-style: italic;">
                    "${guest.message}"
                </div>
            `;
            
            // Remove "no messages" placeholder if exists
            const placeholder = container.querySelector('.info');
            if (placeholder) placeholder.remove();
            
            // Add to top
            container.insertBefore(newMessage, container.firstChild);
            
            // Scroll to show new message
            container.scrollTop = 0;
        }

        function confirmAttendance() {
            // Reset decline button if it was stolen
            const declineBtn = document.getElementById('declineBtn');
            declineBtn.classList.remove('stolen-btn');
            declineBtn.style.display = 'inline-block';
            
            // Hi·ªán form guestbook sau khi nh·∫•n ƒë·ªìng √Ω
            document.getElementById('guestbook').style.display = 'block';
            
            // Scroll xu·ªëng form
            document.getElementById('guestbook').scrollIntoView({ behavior: 'smooth' });
            
            // Thay ƒë·ªïi n·ªôi dung th√¥ng b√°o
            const rsvpSection = document.querySelector('.command-line:last-child');
            rsvpSection.innerHTML = '<span class="prompt">$ </span><span class="command">rsvp --confirm --guests=1</span>';
        }

        function declineAttendance() {
            declineAttempts++;
            const terminal = document.querySelector('.terminal');
            const declineBtn = document.getElementById('declineBtn');
            
            // Create warning messages
            const warnings = [
                'üö® ALERT: Decline button has been STOLEN! üö®',
                '‚ö†Ô∏è A sketchy figure is running away with the decline button!',
                'üèÉ *running sounds* üîä',
                '‚ö†Ô∏è The thief is getting away! üèÉüí®',
                '‚ö†Ô∏è Button thief is almost gone! üèÉüí®üí®',
                'üîç Police report: Button thief escaped!',
                '‚úÖ A new decline button has been deployed!',
                '‚ö†Ô∏è WARNING: This button may also be stolen! üòÇ'
            ];

            if (declineAttempts === 1) {
                // First attempt - show initial warnings
                addTerminalMessage('INFO', 'üéâ H√£y ƒë·∫øn ƒë·ªÉ ch√∫c m·ª´ng Gi·ªõi tho√°t kh·ªèi server HUST! üéâ');
                addTerminalMessage('ERROR', warnings[0], 'terminal-warning');
                addTerminalMessage('WARNING', warnings[1]);
                
                // Start the button stealing animation
                setTimeout(() => {
                    addTerminalMessage('INFO', warnings[2]);
                    declineBtn.classList.add('stolen-btn');
                }, 1000);
                
                setTimeout(() => addTerminalMessage('WARNING', warnings[3]), 2000);
                setTimeout(() => addTerminalMessage('WARNING', warnings[4]), 3000);
                setTimeout(() => addTerminalMessage('INFO', warnings[5]), 4000);
                setTimeout(() => {
                    addTerminalMessage('SUCCESS', warnings[6]);
                    // Restore button
                    declineBtn.classList.remove('stolen-btn');
                    declineBtn.style.display = 'inline-block';
                }, 5000);
                setTimeout(() => addTerminalMessage('WARNING', warnings[7]), 6000);
                
            } else if (declineAttempts === 2) {
                // Second attempt - more dramatic
                addTerminalMessage('ERROR', 'üö® ALERT: Decline button has been STOLEN AGAIN! üö®', 'terminal-warning');
                addTerminalMessage('WARNING', 'üïµÔ∏è A professional button thief has arrived!');
                addTerminalMessage('INFO', 'üí® *whoosh sounds* The button disappeared!');
                
                declineBtn.style.display = 'none';
                
                setTimeout(() => {
                    addTerminalMessage('INFO', 'üîç FBI is investigating the button theft...');
                }, 2000);
                
                setTimeout(() => {
                    addTerminalMessage('SUCCESS', 'üõ°Ô∏è Security upgrade complete! New button deployed!');
                    declineBtn.style.display = 'inline-block';
                    declineBtn.innerHTML = 'T·ª´ ch·ªëi (B·∫£o v·ªá)';
                }, 4000);
                
            } else {
                // Third+ attempt - surrender
                addTerminalMessage('WARNING', 'üòÖ OK OK, b·∫°n th·∫≠t s·ª± mu·ªën t·ª´ ch·ªëi √†?');
                addTerminalMessage('INFO', 'üíî Bu·ªìn qu√°... nh∆∞ng m√¨nh hi·ªÉu m√†...');
                addTerminalMessage('SUCCESS', '‚úÖ ƒê√£ ghi nh·∫≠n: B·∫°n t·ª´ ch·ªëi tham d·ª± (nh∆∞ng m√¨nh v·∫´n hope b·∫°n ƒë·ªïi √Ω!)');
                
                // Hide decline button permanently
                declineBtn.style.display = 'none';
                
                // Add a "changed mind" button
                setTimeout(() => {
                    const changedMindBtn = document.createElement('button');
                    changedMindBtn.className = 'button';
                    changedMindBtn.innerHTML = 'üíö T√¥i ƒë·ªïi √Ω r·ªìi!';
                    changedMindBtn.onclick = () => {
                        addTerminalMessage('SUCCESS', 'üéâ YAY! C·∫£m ∆°n b·∫°n ƒë√£ ƒë·ªïi √Ω! Welcome back! üéâ');
                        confirmAttendance();
                        changedMindBtn.remove();
                    };
                    document.querySelector('.buttons').appendChild(changedMindBtn);
                }, 2000);
            }
        }

        function addTerminalMessage(type, message, className = '') {
            const terminal = document.querySelector('.terminal');
            const timestamp = new Date().toLocaleTimeString();
            
            const newMessage = document.createElement('div');
            newMessage.className = `command-line ${className}`;
            
            let typeColor = '#00aaff'; // INFO
            if (type === 'SUCCESS') typeColor = '#00ff00';
            if (type === 'WARNING') typeColor = '#ff9900';
            if (type === 'ERROR') typeColor = '#ff0000';
            
            newMessage.innerHTML = `
                <span class="prompt">[${timestamp.slice(0, 5)}] </span>
                <span style="color: ${typeColor};">${type}</span>
                <span style="margin-left: 10px;">${message}</span>
            `;
            
            terminal.appendChild(newMessage);
            newMessage.scrollIntoView({ behavior: 'smooth' });
        }

        async function submitGuestbook() {
            const name = document.getElementById('guestName').value;
            const message = document.getElementById('guestMessage').value;
            
            if (!name.trim() || !message.trim()) {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß t√™n v√† l·ªùi nh·∫Øn!');
                return;
            }
            
            try {
                // Show loading
                const submitBtn = document.querySelector('#guestbook button');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'ƒêang g·ª≠i...';
                submitBtn.disabled = true;
                
                const response = await fetch('/api/rsvp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: name.trim(),
                        message: message.trim(),
                        status: 'confirmed',
                        timestamp: new Date().toISOString()
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    // Show success message in terminal
                    addTerminalMessage('SUCCESS', `‚úÖ L∆∞u b√∫t ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng!`);
                    addTerminalMessage('INFO', `üìù Gi·ªõi s·∫Ω nh·∫≠n ƒë∆∞·ª£c l·ªùi ch√∫c c·ªßa ${name} ngay l·∫≠p t·ª©c`);
                    addTerminalMessage('INFO', `üÜî M√£ x√°c nh·∫≠n: #${result.guest.id}`);
                    
                    // Update stats display
                    loadStats();
                    
                    // Reset form
                    document.getElementById('guestName').value = '';
                    document.getElementById('guestMessage').value = '';
                    
                    // Hide form
                    document.getElementById('guestbook').style.display = 'none';
                    
                    // Scroll to stats
                    document.getElementById('statsDisplay').scrollIntoView({ behavior: 'smooth' });
                    
                } else {
                    throw new Error(result.error || 'Failed to save RSVP');
                }
                
            } catch (error) {
                console.error('Error:', error);
                addTerminalMessage('ERROR', `‚ùå L·ªói: ${error.message}`, 'terminal-warning');
            } finally {
                // Reset button
                const submitBtn = document.querySelector('#guestbook button');
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        function cancelGuestbook() {
            document.getElementById('guestbook').style.display = 'none';
            document.getElementById('guestName').value = '';
            document.getElementById('guestMessage').value = '';
        }

        // Document ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Terminal loaded successfully!');
            loadStats(); // Load stats instead of full messages
            startLocationPolling(); // Start checking for live location
            
            // Add secret admin commands for Gi·ªõi
            document.addEventListener('keydown', function(e) {
                // Press Ctrl+Shift+L to open location sharing (for Gi·ªõi)
                if (e.ctrlKey && e.shiftKey && e.key === 'L') {
                    openLocationAdmin();
                }
                // Press Ctrl+Shift+G to open guestbook admin (for Gi·ªõi)  
                if (e.ctrlKey && e.shiftKey && e.key === 'G') {
                    openGuestbookAdmin();
                }
            });
        });

        // Open guestbook admin
        function openGuestbookAdmin() {
            const password = prompt('Admin password ƒë·ªÉ xem l∆∞u b√∫t:');
            if (password) {
                window.open(`/api/admin/guestbook?password=${password}`, '_blank');
            }
        }

        // Secret admin panel for location sharing
        function openLocationAdmin() {
            const password = prompt('Admin password:');
            if (password === 'Gi·ªõi_graduation_2025') {
                showLocationAdmin();
            }
        }

        // Mobile-friendly location admin
        function showMobileLocationAdmin() {
            const adminPanel = document.createElement('div');
            adminPanel.id = 'mobileLocationAdmin';
            adminPanel.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.95); z-index: 2000;
                display: flex; flex-direction: column; padding: 20px;
                overflow-y: auto;
            `;
            adminPanel.innerHTML = `
                <div style="background: #000; border: 2px solid #00ff00; border-radius: 10px; padding: 20px; flex: 1; max-width: 500px; margin: auto;">
                    <h2 style="color: #00ff00; text-align: center; margin-bottom: 20px;">üì± Mobile Location Sharing</h2>
                    
                    <div style="background: #111; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                        <h3 style="color: #ffff00; margin-bottom: 10px;">üéØ Quick Actions:</h3>
                        
                        <button onclick="shareCurrentLocationOnce()" 
                                style="width: 100%; padding: 15px; margin: 5px 0; background: #006600; color: white; border: none; border-radius: 5px; font-size: 16px;">
                            üìç Share V·ªã Tr√≠ Hi·ªán T·∫°i
                        </button>
                        
                        <button onclick="startLocationSharing()" 
                                style="width: 100%; padding: 15px; margin: 5px 0; background: #0066aa; color: white; border: none; border-radius: 5px; font-size: 16px;">
                            üîÑ B·∫≠t Auto-Share (2 ph√∫t/l·∫ßn)
                        </button>
                        
                        <button onclick="stopLocationSharing()" 
                                style="width: 100%; padding: 15px; margin: 5px 0; background: #aa0000; color: white; border: none; border-radius: 5px; font-size: 16px;">
                            üõë D·ª´ng Location Sharing
                        </button>
                    </div>

                    <div style="background: #111; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                        <h3 style="color: #ffff00; margin-bottom: 10px;">‚úèÔ∏è Custom Message:</h3>
                        
                        <input type="text" id="mobileLocationDesc" placeholder="VD: ƒêang ·ªü qu√°n cafe g·∫ßn c·ªïng C1" 
                               style="width: 100%; padding: 10px; margin: 5px 0; background: #222; border: 1px solid #333; color: white; border-radius: 3px;">
                        
                        <textarea id="mobileLocationNote" placeholder="VD: T√¨m m√¨nh ·ªü ƒë√¢y nh√©! G·ªçi ƒëi·ªán n·∫øu kh√¥ng th·∫•y."
                                  style="width: 100%; height: 80px; padding: 10px; margin: 5px 0; background: #222; border: 1px solid #333; color: white; border-radius: 3px; resize: vertical;"></textarea>
                        
                        <button onclick="shareCustomLocation()" 
                                style="width: 100%; padding: 12px; margin: 10px 0; background: #aa6600; color: white; border: none; border-radius: 5px; font-size: 16px;">
                            üìù Share v·ªõi Custom Message
                        </button>
                    </div>

                    <div style="text-align: center;">
                        <button onclick="closeMobileLocationAdmin()" 
                                style="padding: 12px 30px; background: #666; color: white; border: none; border-radius: 5px; font-size: 16px;">
                            ‚ùå ƒê√≥ng
                        </button>
                    </div>

                    <div style="margin-top: 20px; padding: 10px; background: #220000; border-radius: 5px; font-size: 12px; color: #ff6666;">
                        <strong>‚ö†Ô∏è L∆∞u √Ω:</strong> C·∫ßn cho ph√©p truy c·∫≠p v·ªã tr√≠ khi browser h·ªèi. 
                        Location s·∫Ω ƒë∆∞·ª£c chia s·∫ª real-time v·ªõi t·∫•t c·∫£ kh√°ch m·ªùi.
                    </div>
                </div>
            `;
            document.body.appendChild(adminPanel);
        }

        // Mobile location functions
        async function shareCurrentLocationOnce() {
            try {
                addTerminalMessage('INFO', 'üìç ƒêang l·∫•y v·ªã tr√≠ hi·ªán t·∫°i...');
                const location = await getCurrentLocation();
                const mapsUrl = generateMapsLink(location.lat, location.lng);
                
                await shareLocation({
                    isActive: true,
                    description: `üìç Gi·ªõi ƒëang ·ªü ƒë√¢y (${location.accuracy}m)`,
                    mapUrl: mapsUrl,
                    phone: '0365211103',
                    note: `C·∫≠p nh·∫≠t ${new Date().toLocaleTimeString('vi-VN')}. Click Maps ƒë·ªÉ t√¨m m√¨nh!`
                });

                addTerminalMessage('SUCCESS', '‚úÖ ƒê√£ share v·ªã tr√≠ th√†nh c√¥ng!');
                closeMobileLocationAdmin();
            } catch (error) {
                addTerminalMessage('ERROR', `‚ùå L·ªói: ${error.message}`, 'terminal-warning');
            }
        }

        async function shareCustomLocation() {
            try {
                const customDesc = document.getElementById('mobileLocationDesc').value.trim();
                const customNote = document.getElementById('mobileLocationNote').value.trim();
                
                addTerminalMessage('INFO', 'üìç ƒêang l·∫•y v·ªã tr√≠ v·ªõi custom message...');
                const location = await getCurrentLocation();
                const mapsUrl = generateMapsLink(location.lat, location.lng);
                
                await shareLocation({
                    isActive: true,
                    description: customDesc || `üìç Gi·ªõi ƒëang ·ªü ƒë√¢y`,
                    mapUrl: mapsUrl,
                    phone: '0365211103',
                    note: customNote || `C·∫≠p nh·∫≠t ${new Date().toLocaleTimeString('vi-VN')}`
                });

                addTerminalMessage('SUCCESS', '‚úÖ ƒê√£ share location v·ªõi custom message!');
                closeMobileLocationAdmin();
            } catch (error) {
                addTerminalMessage('ERROR', `‚ùå L·ªói: ${error.message}`, 'terminal-warning');
            }
        }

        function closeMobileLocationAdmin() {
            const panel = document.getElementById('mobileLocationAdmin');
            if (panel) panel.remove();
        }

        async function activateLocation() {
            const description = document.getElementById('locationDesc').value;
            const mapUrl = document.getElementById('locationUrl').value;
            const phone = document.getElementById('locationPhone').value;
            const note = document.getElementById('locationNote').value;

            await shareLocation({
                isActive: true,
                description,
                mapUrl,
                phone,
                note
            });

            alert('‚úÖ Live location ƒë√£ ƒë∆∞·ª£c b·∫≠t!');
            closeLocationAdmin();
        }

        async function deactivateLocation() {
            await shareLocation({ isActive: false });
            alert('‚ùå Live location ƒë√£ ƒë∆∞·ª£c t·∫Øt!');
            closeLocationAdmin();
        }

        function closeLocationAdmin() {
            const panel = document.getElementById('locationAdmin');
            if (panel) panel.remove();
        }
    </script>
</body>
</html>