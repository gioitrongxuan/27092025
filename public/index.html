<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·ªÖ T·ªët nghi·ªáp - Terminal Style</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
            padding: 20px;
            overflow-x: auto;
        }

        .terminal {
            max-width: 800px;
            margin: 0 auto;
        }

        .ascii-art {
            font-size: 8px;
            line-height: 1;
            white-space: pre;
            margin-bottom: 20px;
            color: #00ff00;
        }

        .command-line {
            margin: 10px 0;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }

        .prompt {
            color: #ffff00;
            display: inline;
        }

        .command {
            color: #00ffff;
        }

        .output {
            margin: 10px 0 20px 0;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }

        .success {
            color: #00ff00;
        }

        .info {
            color: #00aaff;
        }

        .warning {
            color: #ff9900;
        }

        .event-details {
            background: #111;
            border: 1px solid #00ff00;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .detail-row {
            display: flex;
            align-items: center;
            margin: 10px 0;
            gap: 10px;
        }

        .icon {
            font-size: 20px;
            width: 30px;
        }

        .label {
            font-weight: bold;
            min-width: 80px;
        }

        .value {
            color: #ffffff;
        }

        .map-link {
            color: #00ffff;
            text-decoration: underline;
            cursor: pointer;
        }

        .map-link:hover {
            color: #ffff00;
        }

        .button {
            background: #001100;
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 10px 20px;
            font-family: inherit;
            font-size: 14px;
            cursor: pointer;
            margin: 10px 5px;
            border-radius: 3px;
            transition: all 0.3s;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .button:hover {
            background: #00ff00;
            color: #000;
        }

        .button:active {
            transform: scale(0.98);
        }

        .decline-btn {
            background: #110000 !important;
            border-color: #ff0000 !important;
            color: #ff0000 !important;
        }

        .decline-btn:hover {
            background: #ff0000 !important;
            color: #000 !important;
            animation: shake 0.5s;
        }

        .stolen-btn {
            position: absolute !important;
            pointer-events: none !important;
            opacity: 0.5 !important;
            transform: translateX(200px) !important;
            transition: all 0.3s ease !important;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .terminal-warning {
            background: #220000;
            border-left: 4px solid #ff0000;
            padding: 10px;
            margin: 10px 0;
            animation: blink-red 1s infinite;
        }

        @keyframes blink-red {
            0%, 50% { background: #220000; }
            51%, 100% { background: #330000; }
        }

        .guestbook {
            margin-top: 30px;
            border-top: 1px solid #333;
            padding-top: 20px;
        }

        .guestbook input {
            background: #000;
            border: 1px solid #00ff00;
            color: #00ff00;
            font-family: inherit;
            border-radius: 3px;
        }

        .guestbook input:focus,
        .guestbook textarea:focus {
            outline: none;
            border-color: #ffff00;
            box-shadow: 0 0 5px #00ff00;
        }

        .typing {
            display: inline-block;
            animation: typing 3s steps(30) 1s forwards, blink 1s infinite;
            white-space: nowrap;
            overflow: hidden;
            border-right: 2px solid #00ff00;
            width: 0;
        }

        @keyframes typing {
            to { width: 100%; }
        }

        @keyframes blink {
            0%, 50% { border-color: #00ff00; }
            51%, 100% { border-color: transparent; }
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .command-line:nth-child(1) { animation-delay: 0s; }
        .command-line:nth-child(2) { animation-delay: 1s; }
        .command-line:nth-child(3) { animation-delay: 2s; }
        .command-line:nth-child(4) { animation-delay: 3s; }
        .command-line:nth-child(5) { animation-delay: 4s; }
        .output:nth-child(6) { animation-delay: 5s; }

        /* Live Location Styles */
        .live-location {
            background: #001122;
            border: 2px solid #00aaff;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
            animation: pulse 2s infinite;
        }

        .live-location.active {
            border-color: #00ff00;
            background: #002200;
            animation: pulse-green 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 170, 255, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 170, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 170, 255, 0); }
        }

        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 255, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0); }
        }

        .location-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #666;
            animation: blink 1s infinite;
        }

        .status-dot.active {
            background: #00ff00;
        }

        .location-sharing {
            background: #002211;
            border: 2px solid #00ff88;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }

        .share-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .location-button {
            background: #003300;
            border: 1px solid #00ff00;
            color: #00ff00;
            padding: 8px 16px;
            border-radius: 3px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
        }

        .location-button:hover {
            background: #00ff00;
            color: #000;
        }

        .location-button.active {
            background: #00aa00;
            color: #fff;
        }

        @media (max-width: 600px) {
            .ascii-art {
                font-size: 6px;
            }
            
            body {
                padding: 10px;
                font-size: 12px;
            }
            
            .event-details {
                padding: 15px;
            }
            
            .detail-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .share-controls {
                flex-direction: column;
            }

            .location-button {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="terminal">
        <div class="ascii-art">
 ____  ___  __      __  ___   ____  __  ____ _________  ____   ____  
/  _ \|   ||  |__  |  ||   \ |    \|  ||  __|_   _|_  \|    \ /    | 
|  | ||   ||  ___| |  ||    \|  D  )  ||  _|  | |   | ||  D  )   __| 
|  |_||___||  |    |  ||  D  |    /|  ||  |   | |   | ||    /|  |_  
|     |    |__|    |__||_____|___|_|__||__|   |_|   |_||___|_\|_____|
        </div>

        <div class="command-line">
            <span class="prompt">$ </span>
            <span class="command typing">./graduation.sh --ceremony="Class of 2025"</span>
        </div>

        <div class="command-line">
            <span class="prompt">[] </span>
            <span class="info">INFO</span>
        </div>

        <div class="command-line">
            <span class="success">ƒêƒÉng nh·∫≠p th√†nh c√¥ng!</span>
        </div>

        <div class="command-line">
            <span class="prompt">[] </span>
            <span class="success">SUCCESS</span>
        </div>

        <div class="output">
            <h2 style="color: #ffff00; margin-bottom: 20px;">Th√¢n m·ªùi b·∫°n ƒë·∫øn tham d·ª±:</h2>
            <h1 style="color: #00ffff; margin-bottom: 30px; font-size: 24px;">L·ªÖ T·ªët nghi·ªáp c·ªßa Gi·ªõi</h1>
            
            <div class="event-details">
                <div class="detail-row">
                    <span class="icon">üìÖ</span>
                    <span class="label">Th·ªùi gian:</span>
                    <div class="value">
                        <div>09:30 - 11:00</div>
                        <div>27/09/2025</div>
                    </div>
                </div>
                
                <div class="detail-row">
                    <span class="icon">üìç</span>
                    <span class="label">ƒê·ªãa ƒëi·ªÉm:</span>
                    <div class="value">
                        <div>H·ªôi tr∆∞·ªùng C2</div>
                        <div>ƒê·∫°i h·ªçc B√°ch khoa H√† N·ªôi</div>
                        <div><a href="https://maps.app.goo.gl/ZSpb4NJHbXPJ5SrM6" class="map-link">Click ƒë·ªÉ m·ªü Google Maps</a></div>
                    </div>
                </div>
            </div>

            <!-- Live Location Section -->
            <div class="live-location" id="liveLocationSection">
                <div class="location-status">
                    <span class="status-dot" id="statusDot"></span>
                    <h3 style="color: #00aaff;">üìç V·ªä TR√ç TR·ª∞C TI·∫æP C·ª¶A GI·ªöI</h3>
                </div>
                
                <div id="locationContent">
                    <div class="info">üîÑ ƒêang ki·ªÉm tra tr·∫°ng th√°i chia s·∫ª v·ªã tr√≠...</div>
                </div>

                <!-- Location Sharing Controls (for host) -->
                <div class="location-sharing" id="locationSharing" style="display: none;">
                    <h4 style="color: #00ff88; margin-bottom: 10px;">üéì ƒêI·ªÄU KHI·ªÇN V·ªä TR√ç (CH·ªà CH·ª¶ L·ªÑ)</h4>
                    <div>
                        <input type="password" id="adminKey" placeholder="Nh·∫≠p m·∫≠t kh·∫©u admin" 
                               style="width: 200px; padding: 5px; background: #000; border: 1px solid #00ff00; color: #00ff00; margin-bottom: 10px;">
                    </div>
                    <div class="share-controls">
                        <button class="location-button" id="startLocationBtn">üì° B·∫≠t chia s·∫ª v·ªã tr√≠</button>
                        <button class="location-button" id="stopLocationBtn">‚èπÔ∏è D·ª´ng chia s·∫ª</button>
                        <button class="location-button" id="shareOnceBtn">üìå Chia s·∫ª v·ªã tr√≠ hi·ªán t·∫°i</button>
                        <button class="location-button" id="toggleControlsBtn">‚öôÔ∏è ·∫®n/Hi·ªán panel</button>
                    </div>
                    <div id="locationStatus" style="margin-top: 10px; color: #ffff00;"></div>
                </div>
            </div>

            <div style="margin: 20px 0;">
                <p style="color: #ffff00;">Nh·∫•n "ƒê·ªìng √Ω" v√† vi·∫øt l∆∞u b√∫t cho m√¨nh b√™n d∆∞·ªõi nh√©!</p>
            </div>

            <div class="buttons">
                <button class="button" id="confirmBtn">ƒê·ªìng √Ω tham d·ª±</button>
                <button class="button decline-btn" id="declineBtn">T·ª´ ch·ªëi</button>
            </div>

            <div class="warning" style="margin-top: 20px;">
                <h3>L∆∞u √Ω:</h3>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>H√£y ƒë·ª©ng ch·ªù m√¨nh quanh qu·∫£ng tr∆∞·ªùng C1 v√† g·ªçi ƒëi·ªán tho·∫°i ƒë·ªÉ bi·∫øt m√¨nh ·ªü ƒë√¢u nh√©.</li>
                    <li>M√¨nh s·∫Ω chia s·∫ª v·ªã tr√≠ tr·ª±c ti·∫øp ·ªü ph·∫ßn b√™n tr√™n v√†o bu·ªïi l·ªÖ t·ªët nghi·ªáp.</li>
                    <li>SƒêT: 0374348370</li>
                </ul>
            </div>

            <div class="guestbook" id="guestbook" style="display: none;">
                <h3 style="color: #00ffff; margin-bottom: 15px;">üìù L∆∞u b√∫t cho Gi·ªõi</h3>
                
                <div style="margin-bottom: 15px;">
                    <label style="color: #ffff00; display: block; margin-bottom: 5px;">T√äN C·ª¶A BAN:</label>
                    <input type="text" id="guestName" placeholder="Nh·∫≠p t√™n c·ªßa ban" style="width: 100%; padding: 8px; background: #000; border: 1px solid #00ff00; color: #00ff00; font-family: inherit;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="color: #ffff00; display: block; margin-bottom: 5px;">NH·∫¨P L·ªúI NH·∫ÆN:</label>
                    <textarea id="guestMessage" placeholder="Nh·∫≠p l·ªùi nh·∫Øn cho Gi·ªõi..." style="width: 100%; height: 100px; background: #000; border: 1px solid #00ff00; color: #00ff00; font-family: inherit; padding: 10px; resize: vertical;"></textarea>
                </div>
                
                <div style="text-align: center;">
                    <button class="button" onclick="submitGuestbook()">G·ª¨I</button>
                    <button class="button" style="background: #331100; border-color: #ff6600; color: #ff6600;" onclick="cancelGuestbook()">H·ª¶Y</button>
                </div>
            </div>

            <div class="command-line" style="margin-top: 30px;">
                <span class="prompt">$ </span>
                <span class="command">rsvp --confirm --guests=1</span>
                <span style="animation: blink 1s infinite;">_</span>
            </div>
        </div>
    </div>

    <script>
        let declineAttempts = 0;
        let buttonThiefActive = false;
        let locationWatchId = null;
        let isLocationSharing = false;

        // Check if this is mobile device
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // Initialize location features
        function initializeLocation() {
            // Always show location controls on any device (remove mobile-only restriction)
            document.getElementById('locationSharing').style.display = 'block';
            
            if (isMobile()) {
                addTerminalMessage('INFO', 'üì± Thi·∫øt b·ªã di ƒë·ªông ph√°t hi·ªán. Ch·ª©c nƒÉng chia s·∫ª v·ªã tr√≠ s·∫µn s√†ng.');
            } else {
                addTerminalMessage('INFO', 'üíª Desktop ph√°t hi·ªán. B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng ch·ª©c nƒÉng chia s·∫ª v·ªã tr√≠.');
            }
            
            // Check live location status
            checkLiveLocationStatus();
            
            // Update location status every 30 seconds
            setInterval(checkLiveLocationStatus, 30000);
        }

        // Check live location status from server
        async function checkLiveLocationStatus() {
            try {
                // This would normally fetch from your server
                // For demo, we'll simulate the API call
                const mockLocationData = {
                    isActive: false,
                    description: '',
                    mapUrl: '',
                    phone: '0374348370',
                    note: '',
                    timestamp: null
                };

                updateLocationDisplay(mockLocationData);
            } catch (error) {
                console.error('Error checking location status:', error);
            }
        }

        // Update location display
        function updateLocationDisplay(locationData) {
            const statusDot = document.getElementById('statusDot');
            const locationContent = document.getElementById('locationContent');
            const liveLocationSection = document.getElementById('liveLocationSection');

            if (locationData.isActive) {
                statusDot.classList.add('active');
                liveLocationSection.classList.add('active');
                
                locationContent.innerHTML = `
                    <div class="success">üü¢ Gi·ªõi ƒëang chia s·∫ª v·ªã tr√≠ tr·ª±c ti·∫øp!</div>
                    <div style="margin: 10px 0;">
                        <div style="color: #ffffff;">${locationData.description || 'ƒêang c·∫≠p nh·∫≠t v·ªã tr√≠...'}</div>
                        ${locationData.mapUrl ? `<div style="margin-top: 5px;"><a href="${locationData.mapUrl}" class="map-link" target="_blank">üó∫Ô∏è M·ªü Google Maps</a></div>` : ''}
                        <div style="color: #00aaff; font-size: 12px; margin-top: 5px;">
                            üìû ${locationData.phone} | ‚è∞ C·∫≠p nh·∫≠t: ${locationData.timestamp ? new Date(locationData.timestamp).toLocaleTimeString('vi-VN') : 'N/A'}
                        </div>
                        ${locationData.note ? `<div style="color: #ffff00; margin-top: 5px;">üí° ${locationData.note}</div>` : ''}
                    </div>
                `;
            } else {
                statusDot.classList.remove('active');
                liveLocationSection.classList.remove('active');
                
                locationContent.innerHTML = `
                    <div class="warning">üî¥ Ch∆∞a c√≥ v·ªã tr√≠ tr·ª±c ti·∫øp</div>
                    <div style="color: #888; margin-top: 5px;">
                        Gi·ªõi s·∫Ω chia s·∫ª v·ªã tr√≠ tr·ª±c ti·∫øp v√†o bu·ªïi l·ªÖ t·ªët nghi·ªáp.<br>
                        H√£y quay l·∫°i trang n√†y v√†o ng√†y 27/09/2025!
                    </div>
                `;
            }
        }

        // Get current position with better error handling
        function getCurrentPosition() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã GPS'));
                    return;
                }

                // Check if geolocation permission is already granted
                if (navigator.permissions) {
                    navigator.permissions.query({name: 'geolocation'}).then(function(result) {
                        if (result.state === 'denied') {
                            reject(new Error('Quy·ªÅn truy c·∫≠p v·ªã tr√≠ b·ªã t·ª´ ch·ªëi. Vui l√≤ng b·∫≠t trong c√†i ƒë·∫∑t tr√¨nh duy·ªát.'));
                            return;
                        }
                    });
                }

                navigator.geolocation.getCurrentPosition(
                    position => {
                        const { latitude, longitude, accuracy } = position.coords;
                        resolve({ latitude, longitude, accuracy });
                    },
                    error => {
                        let message = 'Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                message = 'Quy·ªÅn truy c·∫≠p v·ªã tr√≠ b·ªã t·ª´ ch·ªëi. H√£y b·∫≠t trong c√†i ƒë·∫∑t tr√¨nh duy·ªát v√† t·∫£i l·∫°i trang.';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                message = 'V·ªã tr√≠ kh√¥ng kh·∫£ d·ª•ng. H√£y ki·ªÉm tra GPS v√† k·∫øt n·ªëi m·∫°ng.';
                                break;
                            case error.TIMEOUT:
                                message = 'Timeout khi l·∫•y v·ªã tr√≠. Vui l√≤ng th·ª≠ l·∫°i.';
                                break;
                        }
                        reject(new Error(message));
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 15000,
                        maximumAge: 60000
                    }
                );
            });
        }

        // Start location sharing
        async function startLocationSharing() {
            const adminKey = document.getElementById('adminKey').value;
            if (!adminKey) {
                updateLocationStatus('‚ö†Ô∏è Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u admin!');
                return;
            }

            try {
                updateLocationStatus('üîÑ ƒêang xin quy·ªÅn truy c·∫≠p v·ªã tr√≠...');
                
                // Request location permission first
                if (!navigator.geolocation) {
                    throw new Error('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã GPS');
                }

                // Get current position to test permission
                const position = await getCurrentPosition();
                updateLocationStatus('‚úÖ ƒê√£ l·∫•y ƒë∆∞·ª£c v·ªã tr√≠, ƒëang k√≠ch ho·∫°t chia s·∫ª...');
                
                const mapUrl = `https://www.google.com/maps?q=${position.latitude},${position.longitude}`;
                
                // Simulate sending to server (replace with actual API call)
                await simulateServerUpdate({
                    adminKey: adminKey,
                    isActive: true,
                    description: `üìç T·ªça ƒë·ªô hi·ªán t·∫°i: ${position.latitude.toFixed(6)}, ${position.longitude.toFixed(6)}`,
                    mapUrl: mapUrl,
                    phone: '0374348370',
                    note: `ƒê·ªô ch√≠nh x√°c: ~${Math.round(position.accuracy)}m | Chia s·∫ª li√™n t·ª•c`
                });

                // Update UI
                isLocationSharing = true;
                updateLocationDisplay({
                    isActive: true,
                    description: `üìç T·ªça ƒë·ªô hi·ªán t·∫°i: ${position.latitude.toFixed(6)}, ${position.longitude.toFixed(6)}`,
                    mapUrl: mapUrl,
                    phone: '0374348370',
                    note: `ƒê·ªô ch√≠nh x√°c: ~${Math.round(position.accuracy)}m | Chia s·∫ª li√™n t·ª•c`,
                    timestamp: new Date()
                });
                
                updateLocationStatus('‚úÖ Chia s·∫ª v·ªã tr√≠ ƒë√£ ƒë∆∞·ª£c b·∫≠t! ƒêang c·∫≠p nh·∫≠t li√™n t·ª•c...');
                addTerminalMessage('SUCCESS', 'üì° Chia s·∫ª v·ªã tr√≠ tr·ª±c ti·∫øp ƒë√£ ƒë∆∞·ª£c k√≠ch ho·∫°t th√†nh c√¥ng!');
                
                // Start continuous location updates
                startContinuousLocationUpdates();

            } catch (error) {
                let errorMsg = error.message;
                if (error.code === 1) {
                    errorMsg = 'B·∫°n ƒë√£ t·ª´ ch·ªëi quy·ªÅn truy c·∫≠p v·ªã tr√≠. Vui l√≤ng cho ph√©p trong c√†i ƒë·∫∑t tr√¨nh duy·ªát.';
                } else if (error.code === 2) {
                    errorMsg = 'Kh√¥ng th·ªÉ x√°c ƒë·ªãnh v·ªã tr√≠. H√£y ki·ªÉm tra GPS v√† k·∫øt n·ªëi m·∫°ng.';
                } else if (error.code === 3) {
                    errorMsg = 'Timeout khi l·∫•y v·ªã tr√≠. Vui l√≤ng th·ª≠ l·∫°i.';
                }
                
                updateLocationStatus(`‚ùå L·ªói: ${errorMsg}`);
                addTerminalMessage('ERROR', `‚ùå Kh√¥ng th·ªÉ b·∫≠t chia s·∫ª v·ªã tr√≠: ${errorMsg}`);
                
                // Show instructions for enabling location
                setTimeout(() => {
                    addTerminalMessage('INFO', 'üí° ƒê·ªÉ b·∫≠t v·ªã tr√≠: C√†i ƒë·∫∑t > Quy·ªÅn ri√™ng t∆∞ > V·ªã tr√≠ > Cho ph√©p cho tr√¨nh duy·ªát');
                }, 2000);
            }
        }

        // Simulate server update (replace with actual fetch to your API)
        async function simulateServerUpdate(data) {
            return new Promise((resolve) => {
                // Simulate network delay
                setTimeout(() => {
                    console.log('Location data would be sent to server:', data);
                    resolve({ success: true });
                }, 1000);
            });
        }

        // Stop location sharing
        async function stopLocationSharing() {
            const adminKey = document.getElementById('adminKey').value;
            if (!adminKey) {
                alert('Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u admin!');
                return;
            }

            try {
                updateLocationStatus('üîÑ ƒêang d·ª´ng chia s·∫ª v·ªã tr√≠...');
                
                // Stop continuous updates
                if (locationWatchId) {
                    navigator.geolocation.clearWatch(locationWatchId);
                    locationWatchId = null;
                }
                
                // Simulate server update
                setTimeout(() => {
                    isLocationSharing = false;
                    updateLocationDisplay({
                        isActive: false,
                        description: '',
                        mapUrl: '',
                        phone: '0374348370',
                        note: '',
                        timestamp: null
                    });
                    
                    updateLocationStatus('‚èπÔ∏è ƒê√£ d·ª´ng chia s·∫ª v·ªã tr√≠');
                    addTerminalMessage('WARNING', '‚èπÔ∏è Chia s·∫ª v·ªã tr√≠ tr·ª±c ti·∫øp ƒë√£ ƒë∆∞·ª£c t·∫Øt');
                }, 1000);

            } catch (error) {
                updateLocationStatus(`‚ùå L·ªói: ${error.message}`);
            }
        }

        // Share current location once
        async function shareCurrentLocation() {
            const adminKey = document.getElementById('adminKey').value;
            if (!adminKey) {
                alert('Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u admin!');
                return;
            }

            try {
                updateLocationStatus('üìç ƒêang l·∫•y v·ªã tr√≠ hi·ªán t·∫°i...');
                
                const position = await getCurrentPosition();
                const mapUrl = `https://www.google.com/maps?q=${position.latitude},${position.longitude}`;
                
                updateLocationDisplay({
                    isActive: true,
                    description: `üìç V·ªã tr√≠ hi·ªán t·∫°i: ${position.latitude.toFixed(6)}, ${position.longitude.toFixed(6)}`,
                    mapUrl: mapUrl,
                    phone: '0374348370',
                    note: `ƒê·ªô ch√≠nh x√°c: ~${Math.round(position.accuracy)}m | Chia s·∫ª 1 l·∫ßn`,
                    timestamp: new Date()
                });
                
                updateLocationStatus('‚úÖ ƒê√£ chia s·∫ª v·ªã tr√≠ hi·ªán t·∫°i');
                addTerminalMessage('SUCCESS', 'üìå V·ªã tr√≠ hi·ªán t·∫°i ƒë√£ ƒë∆∞·ª£c chia s·∫ª');

            } catch (error) {
                updateLocationStatus(`‚ùå L·ªói: ${error.message}`);
            }
        }

        // Start continuous location updates
        function startContinuousLocationUpdates() {
            if (!navigator.geolocation) return;

            locationWatchId = navigator.geolocation.watchPosition(
                position => {
                    if (isLocationSharing) {
                        const { latitude, longitude, accuracy } = position.coords;
                        const mapUrl = `https://www.google.com/maps?q=${latitude},${longitude}`;
                        
                        updateLocationDisplay({
                            isActive: true,
                            description: `üìç T·ªça ƒë·ªô: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`,
                            mapUrl: mapUrl,
                            phone: '0374348370',
                            note: `ƒê·ªô ch√≠nh x√°c: ~${Math.round(accuracy)}m | T·ª± ƒë·ªông c·∫≠p nh·∫≠t`,
                            timestamp: new Date()
                        });
                    }
                },
                error => {
                    console.error('Location watch error:', error);
                    updateLocationStatus(`‚ùå L·ªói theo d√µi v·ªã tr√≠: ${error.message}`);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 15000,
                    maximumAge: 30000
                }
            );
        }

        // Toggle location controls visibility
        function toggleLocationControls() {
            const locationSharing = document.getElementById('locationSharing');
            const isVisible = locationSharing.style.display !== 'none';
            locationSharing.style.display = isVisible ? 'none' : 'block';
            
            if (isVisible) {
                addTerminalMessage('INFO', '‚öôÔ∏è Panel ƒëi·ªÅu khi·ªÉn v·ªã tr√≠ ƒë√£ ƒë∆∞·ª£c ·∫©n');
            } else {
                addTerminalMessage('INFO', '‚öôÔ∏è Panel ƒëi·ªÅu khi·ªÉn v·ªã tr√≠ ƒë√£ ƒë∆∞·ª£c hi·ªÉn th·ªã');
            }
        }

        // Update location status message
        function updateLocationStatus(message) {
            document.getElementById('locationStatus').textContent = message;
        }

        function confirmAttendance() {
            // Reset decline button if it was stolen
            const declineBtn = document.getElementById('declineBtn');
            declineBtn.classList.remove('stolen-btn');
            declineBtn.style.display = 'inline-block';
            
            // Hi·ªán form guestbook sau khi nh·∫•n ƒë·ªìng √Ω
            document.getElementById('guestbook').style.display = 'block';
            
            // Scroll xu·ªëng form
            document.getElementById('guestbook').scrollIntoView({ behavior: 'smooth' });
            
            // Thay ƒë·ªïi n·ªôi dung th√¥ng b√°o
            const rsvpSection = document.querySelector('.command-line:last-child');
            rsvpSection.innerHTML = '<span class="prompt">$ </span><span class="command">rsvp --confirm --guests=1</span>';
        }

        function declineAttendance() {
            declineAttempts++;
            const terminal = document.querySelector('.terminal');
            const declineBtn = document.getElementById('declineBtn');
            
            // Create warning messages
            const warnings = [
                'üö® ALERT: Decline button has been STOLEN! üö®',
                '‚ö†Ô∏è A sketchy figure is running away with the decline button!',
                'üèÉ *running sounds* üîä',
                '‚ö†Ô∏è The thief is getting away! üèÉüí®',
                '‚ö†Ô∏è Button thief is almost gone! üèÉüí®üí®',
                'üîç Police report: Button thief escaped!',
                '‚úÖ A new decline button has been deployed!',
                '‚ö†Ô∏è WARNING: This button may also be stolen! üòÇ'
            ];

            if (declineAttempts === 1) {
                // First attempt - show initial warnings
                addTerminalMessage('INFO', 'üéâ H√£y ƒë·∫øn ƒë·ªÉ ch√∫c m·ª´ng Gi·ªõi tho√°t kh·ªèi server HUST! üéâ');
                addTerminalMessage('ERROR', warnings[0], 'terminal-warning');
                addTerminalMessage('WARNING', warnings[1]);
                
                // Start the button stealing animation
                setTimeout(() => {
                    addTerminalMessage('INFO', warnings[2]);
                    declineBtn.classList.add('stolen-btn');
                }, 1000);
                
                setTimeout(() => addTerminalMessage('WARNING', warnings[3]), 2000);
                setTimeout(() => addTerminalMessage('WARNING', warnings[4]), 3000);
                setTimeout(() => addTerminalMessage('INFO', warnings[5]), 4000);
                setTimeout(() => {
                    addTerminalMessage('SUCCESS', warnings[6]);
                    // Restore button
                    declineBtn.classList.remove('stolen-btn');
                    declineBtn.style.display = 'inline-block';
                }, 5000);
                setTimeout(() => addTerminalMessage('WARNING', warnings[7]), 6000);
                
            } else if (declineAttempts === 2) {
                // Second attempt - more dramatic
                addTerminalMessage('ERROR', 'üö® ALERT: Decline button has been STOLEN AGAIN! üö®', 'terminal-warning');
                addTerminalMessage('WARNING', 'üïµÔ∏è A professional button thief has arrived!');
                addTerminalMessage('INFO', 'üí® *whoosh sounds* The button disappeared!');
                
                declineBtn.style.display = 'none';
                
                setTimeout(() => {
                    addTerminalMessage('INFO', 'üîç FBI is investigating the button theft...');
                }, 2000);
                
                setTimeout(() => {
                    addTerminalMessage('SUCCESS', 'üõ°Ô∏è Security upgrade complete! New button deployed!');
                    declineBtn.style.display = 'inline-block';
                    declineBtn.innerHTML = 'T·ª´ ch·ªëi (B·∫£o v·ªá)';
                }, 4000);
                
            } else {
                // Third+ attempt - surrender
                addTerminalMessage('WARNING', 'üòÖ OK OK, b·∫°n th·∫≠t s·ª± mu·ªën t·ª´ ch·ªëi √†?');
                addTerminalMessage('INFO', 'üíî Bu·ªìn qu√°... nh∆∞ng m√¨nh hi·ªÉu m√†...');
                addTerminalMessage('SUCCESS', '‚úÖ ƒê√£ ghi nh·∫≠n: B·∫°n t·ª´ ch·ªëi tham d·ª± (nh∆∞ng m√¨nh v·∫´n hope b·∫°n ƒë·ªïi √Ω!)');
                
                // Hide decline button permanently
                declineBtn.style.display = 'none';
                
                // Add a "changed mind" button
                setTimeout(() => {
                    const changedMindBtn = document.createElement('button');
                    changedMindBtn.className = 'button';
                    changedMindBtn.innerHTML = 'üíö T√¥i ƒë·ªïi √Ω r·ªìi!';
                    changedMindBtn.onclick = () => {
                        addTerminalMessage('SUCCESS', 'üéâ YAY! C·∫£m ∆°n b·∫°n ƒë√£ ƒë·ªïi √Ω! Welcome back! üéâ');
                        confirmAttendance();
                        changedMindBtn.remove();
                    };
                    document.querySelector('.buttons').appendChild(changedMindBtn);
                }, 2000);
            }
        }

        function addTerminalMessage(type, message, className = '') {
            const terminal = document.querySelector('.terminal');
            const timestamp = new Date().toLocaleTimeString();
            
            const newMessage = document.createElement('div');
            newMessage.className = `command-line ${className}`;
            
            let typeColor = '#00aaff'; // INFO
            if (type === 'SUCCESS') typeColor = '#00ff00';
            if (type === 'WARNING') typeColor = '#ff9900';
            if (type === 'ERROR') typeColor = '#ff0000';
            
            newMessage.innerHTML = `
                <span class="prompt">[${timestamp.slice(0, 5)}] </span>
                <span style="color: ${typeColor};">${type}</span>
                <span style="margin-left: 10px;">${message}</span>
            `;
            
            terminal.appendChild(newMessage);
            newMessage.scrollIntoView({ behavior: 'smooth' });
        }

        async function submitGuestbook() {
            const name = document.getElementById('guestName').value;
            const message = document.getElementById('guestMessage').value;
            
            if (!name.trim() || !message.trim()) {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß t√™n v√† l·ªùi nh·∫Øn!');
                return;
            }
            
            try {
                // Show loading
                const submitBtn = document.querySelector('#guestbook button');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'ƒêang g·ª≠i...';
                submitBtn.disabled = true;
                
                const response = await fetch('/api/rsvp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: name.trim(),
                        message: message.trim(),
                        status: 'confirmed',
                        timestamp: new Date().toISOString()
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    // T·∫°o hi·ªáu ·ª©ng terminal success
                    const terminal = document.querySelector('.terminal');
                    const newOutput = document.createElement('div');
                    newOutput.className = 'command-line';
                    newOutput.innerHTML = `
                        <div style="margin: 20px 0;">
                            <div class="success">‚úÖ G·ª≠i th√†nh c√¥ng l√™n server!</div>
                            <div style="color: #ffffff; margin-top: 10px;">
                                <strong style="color: #ffff00;">T√™n:</strong> ${name}<br>
                                <strong style="color: #ffff00;">L·ªùi nh·∫Øn:</strong> ${message}<br>
                                <strong style="color: #ffff00;">ID:</strong> #${result.guest.id}
                            </div>
                            <div class="info" style="margin-top: 10px;">C·∫£m ∆°n b·∫°n ƒë√£ RSVP! D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l∆∞u! üéâ</div>
                        </div>
                    `;
                    terminal.appendChild(newOutput);
                    
                    // Reset form
                    document.getElementById('guestName').value = '';
                    document.getElementById('guestMessage').value = '';
                    
                    // ·∫®n form
                    document.getElementById('guestbook').style.display = 'none';
                    
                    // Scroll to new message
                    newOutput.scrollIntoView({ behavior: 'smooth' });
                    
                } else {
                    throw new Error(result.error || 'Failed to save RSVP');
                }
                
            } catch (error) {
                console.error('Error:', error);
                addTerminalMessage('ERROR', `‚ùå L·ªói: ${error.message}`, 'terminal-warning');
            } finally {
                // Reset button
                const submitBtn = document.querySelector('#guestbook button');
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        function cancelGuestbook() {
            document.getElementById('guestbook').style.display = 'none';
            document.getElementById('guestName').value = '';
            document.getElementById('guestMessage').value = '';
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Terminal loaded successfully!');
            
            // Add event listeners for location buttons
            const startLocationBtn = document.getElementById('startLocationBtn');
            const stopLocationBtn = document.getElementById('stopLocationBtn');
            const shareOnceBtn = document.getElementById('shareOnceBtn');
            const toggleControlsBtn = document.getElementById('toggleControlsBtn');
            
            if (startLocationBtn) {
                startLocationBtn.addEventListener('click', startLocationSharing);
                startLocationBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    startLocationSharing();
                });
            }
            
            if (stopLocationBtn) {
                stopLocationBtn.addEventListener('click', stopLocationSharing);
                stopLocationBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    stopLocationSharing();
                });
            }
            
            if (shareOnceBtn) {
                shareOnceBtn.addEventListener('click', shareCurrentLocation);
                shareOnceBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    shareCurrentLocation();
                });
            }
            
            if (toggleControlsBtn) {
                toggleControlsBtn.addEventListener('click', toggleLocationControls);
                toggleControlsBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    toggleLocationControls();
                });
            }
            const confirmBtn = document.getElementById('confirmBtn');
            const declineBtn = document.getElementById('declineBtn');
            
            if (confirmBtn) {
                confirmBtn.addEventListener('click', confirmAttendance);
                confirmBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    confirmAttendance();
                });
            }
            
            if (declineBtn) {
                declineBtn.addEventListener('click', declineAttendance);
                declineBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault(); 
                    declineAttendance();
                });
            }
            
            // Initialize location features
            initializeLocation();
            
            // Show device-specific message
            setTimeout(() => {
                if (isMobile()) {
                    addTerminalMessage('INFO', 'Thi·∫øt b·ªã di ƒë·ªông ph√°t hi·ªán. Ch·∫°m v√†o c√°c n√∫t ƒë·ªÉ t∆∞∆°ng t√°c.');
                } else {
                    addTerminalMessage('INFO', 'Desktop ph√°t hi·ªán. Click v√†o c√°c n√∫t ƒë·ªÉ t∆∞∆°ng t√°c.');
                }
            }, 3000);
        });